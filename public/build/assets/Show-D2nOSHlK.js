import{r as c,j as e,L as O,S as p}from"./app-t00vz8yk.js";import{D as z}from"./DashboardLayout-1MrkR7-7.js";import{B as u}from"./button-DOrDzDwb.js";import{T as m,a as h,b as i,c as a,d as x,e as r}from"./table-C5xvP0Q_.js";import{B as A}from"./badge-skWHhfzJ.js";import{S as U}from"./separator-C1ZPAThp.js";import{B as q}from"./breadcrumbs-CpbsUajA.js";import{D as V,a as W,b as G,d as J,e as K}from"./dialog-CqfMpxPU.js";import{A as X}from"./arrow-left-CXZIf0fQ.js";import{P as Y}from"./package-D_FuV0WI.js";import{F as P,U as Z}from"./user-BQgx5HQE.js";import{R as ee}from"./refresh-cw-w192Iegd.js";import{f as j}from"./format-CBpsKyOP.js";import"./index-6Ovb7Dg4.js";import"./utils-BVps5BK6.js";import"./index-BWhO1Zcs.js";import"./sweetalert2.esm.all-DGhwgajj.js";import"./card-DxILUFZ5.js";import"./shopping-cart-CpEA-Iqs.js";import"./log-out-Bh5ug1nn.js";import"./index-DM7d-UGL.js";import"./Combination-Iccp121O.js";const se=t=>{switch(t){case"draft":return"secondary";case"completed":return"default";case"returned":return"destructive";default:return"secondary"}};function we({sale:t}){const[H,b]=c.useState(!1),[N,f]=c.useState({}),[y,S]=c.useState(""),[w,L]=c.useState(""),[g,T]=c.useState(""),[v,k]=c.useState(""),[_,R]=c.useState(!1),I=()=>b(!0),C=()=>{b(!1),f({}),S("")},B=(s,n,d)=>{n<0&&(n=0),n>d&&(n=d),f(l=>({...l,[s]:n}))},E=s=>{s.preventDefault(),t.customer&&p.post(route("sales.processReturn",t.id),{items:Object.entries(N).filter(([n,d])=>d>0).map(([n,d])=>({sale_item_id:n,quantity:d})),reason:y},{onSuccess:()=>C()})},Q=()=>{!g&&!v||(R(!0),p.post(route("sales.attachCustomer",t.id),{name:w||void 0,phone:g||void 0,email:v||void 0},{onFinish:()=>R(!1),onSuccess:()=>{p.reload({only:["sale"]})}}))},$=[{title:"Dashboard",href:route("dashboard")},{title:"Sales",href:route("sales.index")},{title:`Invoice #${t.invoice_number}`,href:route("sales.show",t.id)}];return e.jsxs(z,{title:`Invoice #${t.invoice_number}`,children:[e.jsx(O,{title:`Invoice #${t.invoice_number}`}),e.jsxs("div",{className:"space-y-4 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"outline",onClick:()=>p.visit(route("sales.index")),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Back to Sales"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Invoice #",t.invoice_number]}),e.jsxs("p",{className:"text-muted-foreground",children:["Created on ",j(new Date(t.created_at),"MMM dd, yyyy HH:mm")]})]})]}),e.jsx(A,{variant:se(t.status),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsx(q,{breadcrumbs:$})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Items Purchased"]})}),e.jsx("div",{className:"p-6",children:e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Product"}),e.jsx(a,{children:"Color"}),e.jsx(a,{children:"Size"}),e.jsx(a,{children:"Quantity"}),e.jsx(a,{children:"Price"}),e.jsx(a,{children:"Subtotal"})]})}),e.jsx(x,{children:t.items&&t.items.length>0?t.items.map(s=>{var n,d,l,o;return e.jsxs(i,{children:[e.jsx(r,{children:s.product.name}),e.jsx(r,{children:((d=(n=s.variant)==null?void 0:n.color)==null?void 0:d.name)||"-"}),e.jsx(r,{children:((o=(l=s.variant)==null?void 0:l.size)==null?void 0:o.name)||"-"}),e.jsx(r,{children:s.quantity}),e.jsxs(r,{children:["₹",s.price.toLocaleString()]}),e.jsxs(r,{children:["₹",(s.price*s.quantity).toLocaleString()]})]},s.id)}):e.jsx(i,{children:e.jsx(r,{colSpan:6,className:"text-center text-gray-500",children:"No items"})})})]})})]}),e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Payments"]})}),e.jsx("div",{className:"p-6",children:e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Method"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Paid At"})]})}),e.jsx(x,{children:t.payments&&t.payments.length>0?t.payments.map(s=>e.jsxs(i,{children:[e.jsx(r,{className:"capitalize",children:s.method}),e.jsxs(r,{children:["₹",s.amount.toLocaleString()]}),e.jsx(r,{children:j(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]},s.id)):e.jsx(i,{children:e.jsx(r,{colSpan:3,className:"text-center",children:"No payments recorded"})})})]})})]}),t.returns&&t.returns.length>0&&e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Returns"]})}),e.jsx("div",{className:"p-6",children:t.returns.map(s=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"mb-2 font-medium",children:["Reason: ",s.reason||"-"]}),e.jsxs("div",{className:"mb-2",children:["Refund Total: ",e.jsxs("strong",{children:["₹",s.refund_total.toLocaleString()]})]}),e.jsx("div",{children:"Return Items:"}),e.jsxs(m,{className:"mt-2 mb-4",children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Sale Item ID"}),e.jsx(a,{children:"Quantity"}),e.jsx(a,{children:"Amount"})]})}),e.jsx(x,{children:s.items&&s.items.length>0?s.items.map(n=>e.jsxs(i,{children:[e.jsx(r,{children:n.sale_item_id}),e.jsx(r,{children:n.quantity}),e.jsxs(r,{children:["₹",n.amount.toLocaleString()]})]},n.id)):e.jsx(i,{children:e.jsx(r,{colSpan:3,className:"text-center",children:"No return items"})})})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Returned on ",j(new Date(s.created_at),"MMM dd, yyyy HH:mm")]})]},s.id))})]}),t.status_logs&&t.status_logs.length>0&&e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Status History"]})}),e.jsx("div",{className:"p-6",children:t.status_logs.map(s=>e.jsx("div",{className:"flex items-start gap-4 p-4 border rounded-lg mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(A,{variant:"outline",children:[s.status_from||"---"," → ",s.status_to]}),e.jsx("span",{className:"text-sm text-gray-500",children:j(new Date(s.changed_at),"MMM dd, yyyy HH:mm")})]}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600",children:s.notes}),s.changed_by&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Changed by: ",s.changed_by.name]})]})},s.id))})]}),t.creditNotes&&t.creditNotes.length>0&&e.jsxs("div",{className:"bg-white rounded-md border mt-6",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-lg font-medium flex items-center gap-2",children:"Credit Notes"})}),e.jsx("div",{className:"p-6",children:e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Reference"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Related Return"}),e.jsx(a,{children:"Date"})]})}),e.jsx(x,{children:t.creditNotes.map(s=>e.jsxs(i,{children:[e.jsx(r,{children:s.reference||"-"}),e.jsxs(r,{children:["₹",Number(s.amount).toLocaleString()]}),e.jsx(r,{children:s.status}),e.jsx(r,{children:s.sale_return_id?`#${s.sale_return_id}`:"-"}),e.jsx(r,{children:s.created_at?j(new Date(s.created_at),"MMM dd, yyyy HH:mm"):"-"})]},s.id))})]})})]}),t.refunds&&t.refunds.length>0&&e.jsxs("div",{className:"bg-white rounded-md border mt-6",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-lg font-medium flex items-center gap-2",children:"Refunds"})}),e.jsx("div",{className:"p-6",children:e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Reference"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Method"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Related Credit Note"}),e.jsx(a,{children:"Paid At"})]})}),e.jsx(x,{children:t.refunds.map(s=>e.jsxs(i,{children:[e.jsx(r,{children:s.reference||"-"}),e.jsxs(r,{children:["₹",Number(s.amount).toLocaleString()]}),e.jsx(r,{children:s.method||"-"}),e.jsx(r,{children:s.status}),e.jsx(r,{children:s.credit_note_id?`#${s.credit_note_id}`:"-"}),e.jsx(r,{children:s.paid_at?j(new Date(s.paid_at),"MMM dd, yyyy HH:mm"):"-"})]},s.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("h3",{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Customer Information"]})}),e.jsx("div",{className:"p-6 space-y-4",children:t.customer?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Name"}),e.jsx("p",{className:"font-medium",children:t.customer.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsx("p",{children:t.customer.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Phone"}),e.jsx("p",{children:t.customer.phone})]})]}):e.jsx("div",{className:"text-gray-400",children:"Walk-in Customer"})})]}),e.jsxs("div",{className:"bg-white rounded-md border",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-lg font-medium flex items-center gap-2",children:"Sale Summary"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["₹",t.subtotal.toLocaleString()]})]}),e.jsx(U,{}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["₹",t.total.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Paid:"}),e.jsxs("span",{children:["₹",t.paid_total.toLocaleString()]})]})]})]})]})]}),e.jsxs(V,{open:H,onOpenChange:b,children:[e.jsx(W,{asChild:!0,children:e.jsx(u,{onClick:I,variant:"outline",className:"mb-2",disabled:t.status==="returned",children:"Process Return"})}),e.jsxs(G,{className:"max-w-2xl bg-white",children:[e.jsx(J,{children:"Return Items"}),e.jsx(K,{children:"Select products and quantities to return."}),!t.customer&&e.jsxs("div",{className:"mb-3 p-3 border rounded",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Attach customer to proceed with return"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"border rounded p-2 w-full",placeholder:"Name (optional)",value:w,onChange:s=>L(s.target.value)}),e.jsx("input",{className:"border rounded p-2 w-full",placeholder:"Phone",value:g,onChange:s=>T(s.target.value)}),e.jsx("input",{className:"border rounded p-2 w-full",placeholder:"Email",value:v,onChange:s=>k(s.target.value)})]}),e.jsx("div",{children:e.jsx(u,{type:"button",onClick:Q,disabled:_,children:_?"Attaching...":"Attach Customer"})}),e.jsx("div",{className:"text-xs text-gray-500",children:"Provide phone or email to create a new customer and link to this invoice."})]})]}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(i,{children:[e.jsx(a,{children:"Product"}),e.jsx(a,{children:"Quantity (max)"}),e.jsx(a,{children:"Return Qty"})]})}),e.jsx(x,{children:t.items&&t.items.length>0?t.items.map(s=>{var l;const n=((l=t.returns)==null?void 0:l.reduce((o,F)=>(F.items||[]).reduce((M,D)=>D.sale_item_id===s.id?M+D.quantity:M,o),0))||0,d=s.quantity-n;return e.jsxs(i,{children:[e.jsx(r,{children:s.product.name}),e.jsx(r,{children:d}),e.jsx(r,{children:e.jsx("input",{type:"number",className:"w-20 border rounded p-1",value:N[s.id]||"",min:"0",max:d,onChange:o=>B(s.id,Number(o.target.value),d),disabled:d===0})})]},s.id)}):null})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium mb-1",children:"Reason (optional)"}),e.jsx("textarea",{className:"w-full border rounded p-2",value:y,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:C,children:"Cancel"}),e.jsx(u,{type:"submit",variant:"default",disabled:!t.customer||Object.values(N).every(s=>!s),children:"Submit Return"})]})]})]})]})]})}export{we as default};
