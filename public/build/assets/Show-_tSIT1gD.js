import{r as N,j as e,L as V,S as x}from"./app-8mpgRF_H.js";import{D as E,U as O,F as Q}from"./DashboardLayout-82tPO0nj.js";import{B as r}from"./button-D7KZE6ws.js";import{B as k}from"./badge-BCW-cltX.js";import{C as l,a as n,b as i,c as d,d as C}from"./card-DHAxNADJ.js";import{T as $,a as K,b as M,c as o,d as X,e as m}from"./table-DrecrXJn.js";import{T as w}from"./textarea-CEyZIjXN.js";import{L as a}from"./label-aTU67fCD.js";import{A as G}from"./arrow-left-Dq_VdZ6f.js";import{C as j}from"./circle-check-big-Cyv3UDSl.js";import{C as g}from"./circle-x-CHLO6Tbv.js";import{P as T}from"./package-CuGv9LJN.js";import{C as J}from"./credit-card-DDortawr.js";import{C as _}from"./clock-C2kBjZB7.js";import{C as W}from"./circle-alert-Bz7nOBdv.js";import{f as h}from"./format-CBpsKyOP.js";import"./index-xngnoH4f.js";import"./utils-DT8Sk-eS.js";import"./index-CqoyiOMP.js";import"./sweetalert2.esm.all-DGhwgajj.js";import"./shopping-cart-7o6L9-KU.js";import"./log-out-BAw1qoMr.js";const Y={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800",processing:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"},Z={pending:_,approved:j,rejected:g,processing:W,completed:j,failed:g,cancelled:g},ee={pending:"bg-yellow-100 text-yellow-800",passed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"};function we({refund:s}){var S;const[q,f]=N.useState(!1),[H,v]=N.useState(!1),[p,b]=N.useState(s.admin_notes||""),[y,R]=N.useState(""),F=t=>{const c=Z[t]||_;return e.jsx(c,{className:"h-4 w-4"})},P=()=>{var t,c;return s.customer?s.customer:(t=s.sale)!=null&&t.customer?s.sale.customer:(c=s.order)!=null&&c.customer?s.order.customer:{name:"N/A",email:"N/A",phone:"N/A"}},B=()=>s.sale?{type:"Sale",id:s.sale.id}:s.order?{type:"Order",id:s.order.id}:{type:"N/A",id:"N/A"},D=()=>{x.post(route("refunds.approve",s.id),{admin_notes:p},{onSuccess:()=>{f(!1)}})},L=()=>{x.post(route("refunds.reject",s.id),{rejection_reason:y,admin_notes:p},{onSuccess:()=>{v(!1),R("")}})},U=()=>{x.post(route("refunds.process",s.id))},z=(t,c,I)=>{x.put(route("refund-items.update-qc-status",t),{qc_status:c,qc_notes:I})},u=P(),A=B();return e.jsxs(E,{title:`Refund ${s.reference}`,children:[e.jsx(V,{title:`Refund ${s.reference}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>x.get(route("refunds.index")),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Back to Refunds"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Refund ",s.reference]}),e.jsxs("p",{className:"text-muted-foreground",children:["Created on ",h(new Date(s.created_at),"MMM dd, yyyy HH:mm")]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(k,{className:Y[s.status],children:e.jsxs("span",{className:"flex items-center gap-1",children:[F(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{children:"Refund Details"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Method"}),e.jsx("p",{className:"text-lg",children:((S=s.method)==null?void 0:S.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Reason"}),e.jsx("p",{className:"text-sm",children:s.reason})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Source Transaction"}),e.jsxs("p",{className:"text-sm",children:[A.type," #",A.id]})]})]}),s.admin_notes&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Admin Notes"}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md",children:s.admin_notes})]}),s.rejection_reason&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm bg-red-50 text-red-800 p-3 rounded-md",children:s.rejection_reason})]})]})]}),e.jsxs(l,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Refund Items"}),e.jsx(C,{children:"Items included in this refund request"})]}),e.jsx(d,{children:e.jsxs($,{children:[e.jsx(K,{children:e.jsxs(M,{children:[e.jsx(o,{children:"Product"}),e.jsx(o,{children:"Variant"}),e.jsx(o,{children:"Qty"}),e.jsx(o,{children:"Unit Price"}),e.jsx(o,{children:"Total"}),e.jsx(o,{children:"QC Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(X,{children:s.refund_items.map(t=>e.jsxs(M,{children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.product.name}),t.product.sku&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["SKU: ",t.product.sku]})]})}),e.jsx(m,{children:t.product_variant&&e.jsxs("div",{className:"text-sm",children:[t.product_variant.color&&e.jsxs("div",{children:["Color: ",t.product_variant.color]}),t.product_variant.size&&e.jsxs("div",{children:["Size: ",t.product_variant.size]})]})}),e.jsx(m,{children:t.quantity}),e.jsxs(m,{children:["₹",t.unit_price.toLocaleString()]}),e.jsxs(m,{children:["₹",t.total_amount.toLocaleString()]}),e.jsx(m,{children:e.jsx(k,{className:ee[t.qc_status],children:t.qc_status.charAt(0).toUpperCase()+t.qc_status.slice(1)})}),e.jsx(m,{children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{const c=t.qc_status==="passed"?"failed":"passed";z(t.id,c,t.qc_notes||"")},children:t.qc_status==="passed"?"Mark Failed":"Mark Passed"})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Customer Information"]})}),e.jsxs(d,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm",children:u.name})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:u.email})]}),u.phone&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-sm",children:u.phone})]})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{children:"Actions"})}),e.jsxs(d,{className:"space-y-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{className:"w-full",onClick:()=>f(!0),children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Approve Refund"]}),e.jsxs(r,{variant:"destructive",className:"w-full",onClick:()=>v(!0),children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Reject Refund"]})]}),s.status==="approved"&&e.jsxs(r,{className:"w-full",onClick:U,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Process Refund"]}),s.credit_note&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"View Credit Note"]}),s.refund_transaction&&e.jsxs(r,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"View Transaction"]})]})]}),e.jsxs(l,{children:[e.jsx(n,{children:e.jsx(i,{children:"Timeline"})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Requested"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),s.approved_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Approved"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h(new Date(s.approved_at),"MMM dd, yyyy HH:mm")})]})]}),s.processed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Processed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h(new Date(s.processed_at),"MMM dd, yyyy HH:mm")})]})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Completed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h(new Date(s.completed_at),"MMM dd, yyyy HH:mm")})]})]})]})]})]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(n,{children:[e.jsx(i,{children:"Approve Refund"}),e.jsx(C,{children:"Are you sure you want to approve this refund request?"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"admin_notes",children:"Admin Notes (Optional)"}),e.jsx(w,{id:"admin_notes",value:p,onChange:t=>b(t.target.value),placeholder:"Add any notes about this approval..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:D,className:"flex-1",children:"Approve"}),e.jsx(r,{variant:"outline",onClick:()=>f(!1),className:"flex-1",children:"Cancel"})]})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(n,{children:[e.jsx(i,{children:"Reject Refund"}),e.jsx(C,{children:"Please provide a reason for rejecting this refund request."})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"rejection_reason",children:"Rejection Reason *"}),e.jsx(w,{id:"rejection_reason",value:y,onChange:t=>R(t.target.value),placeholder:"Explain why this refund is being rejected...",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"admin_notes_reject",children:"Admin Notes (Optional)"}),e.jsx(w,{id:"admin_notes_reject",value:p,onChange:t=>b(t.target.value),placeholder:"Add any additional notes..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:"destructive",onClick:L,className:"flex-1",disabled:!y.trim(),children:"Reject"}),e.jsx(r,{variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"Cancel"})]})]})]})})]})]})}export{we as default};
