import{r as f,j as e,L as I,S as o}from"./app-t00vz8yk.js";import{D as E}from"./DashboardLayout-1MrkR7-7.js";import{B as c}from"./button-DOrDzDwb.js";import{B as R}from"./badge-skWHhfzJ.js";import{C as m,a as x,b as h,c as p,d as V}from"./card-DxILUFZ5.js";import{T as O,a as Q,b as S,c as l,d as $,e as i}from"./table-C5xvP0Q_.js";import{T as w}from"./textarea-B-HSaLIF.js";import{L as r}from"./label-B4_iYcyS.js";import{A as K}from"./arrow-left-CXZIf0fQ.js";import{U as X,F as G}from"./user-BQgx5HQE.js";import{C as u}from"./circle-check-big-DyudUJkX.js";import{C as y}from"./circle-x-dxTk8sXT.js";import{P as M}from"./package-D_FuV0WI.js";import{C as J}from"./credit-card-BhJxHFXR.js";import{C}from"./clock--AfF1FlV.js";import{C as W}from"./circle-alert-DQp1glWf.js";import{f as j}from"./format-CBpsKyOP.js";import"./index-6Ovb7Dg4.js";import"./utils-BVps5BK6.js";import"./index-BWhO1Zcs.js";import"./sweetalert2.esm.all-DGhwgajj.js";import"./shopping-cart-CpEA-Iqs.js";import"./log-out-Bh5ug1nn.js";const Y={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800",processing:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"},Z={pending:C,approved:u,rejected:y,processing:W,completed:u,failed:y,cancelled:y},ee={pending:"bg-yellow-100 text-yellow-800",passed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"};function Ce({refund:s}){var A;const[q,v]=f.useState(!1),[T,b]=f.useState(!1),[n,g]=f.useState(s.admin_notes||""),[d,k]=f.useState(""),F=t=>{const a=Z[t]||C;return e.jsx(a,{className:"h-4 w-4"})},H=()=>{var t,a;return s.customer?s.customer:(t=s.sale)!=null&&t.customer?s.sale.customer:(a=s.order)!=null&&a.customer?s.order.customer:{name:"N/A",email:"N/A",phone:"N/A"}},P=()=>s.sale?{type:"Sale",id:s.sale.id}:s.order?{type:"Order",id:s.order.id}:{type:"N/A",id:"N/A"},B=()=>{if(console.log("Approve button clicked",{refund_id:s.id,admin_notes:n}),n.length>1e3){alert("Admin notes cannot exceed 1000 characters");return}o.post(route("refunds.approve",s.id),{admin_notes:n},{onSuccess:t=>{console.log("Approval successful",t),v(!1),g("")},onError:t=>{console.error("Approval failed",t);const a=t.error||"Failed to approve refund. Please try again.";alert(a)},onFinish:()=>{console.log("Approval request finished")}})},D=()=>{if(!d.trim()){alert("Rejection reason is required");return}if(d.trim().length<10){alert("Rejection reason must be at least 10 characters long");return}if(d.length>1e3){alert("Rejection reason cannot exceed 1000 characters");return}if(n.length>1e3){alert("Admin notes cannot exceed 1000 characters");return}o.post(route("refunds.reject",s.id),{rejection_reason:d.trim(),admin_notes:n},{onSuccess:()=>{b(!1),k(""),g("")},onError:t=>{console.error("Rejection failed",t);const a=t.error||"Failed to reject refund. Please try again.";alert(a)}})},L=()=>{o.post(route("refunds.process",s.id))},U=(t,a,z)=>{o.put(route("refund-items.update-qc-status",t),{qc_status:a,qc_notes:z})},N=H(),_=P();return e.jsxs(E,{title:`Refund ${s.reference}`,children:[e.jsx(I,{title:`Refund ${s.reference}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(c,{variant:"outline",className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",size:"sm",onClick:()=>o.get(route("refunds.index")),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Back to Refunds"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Refund ",s.reference]}),e.jsxs("p",{className:"text-muted-foreground",children:["Created on ",j(new Date(s.created_at),"MMM dd, yyyy HH:mm")]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(R,{className:Y[s.status],children:e.jsxs("span",{className:"flex items-center gap-1",children:[F(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Refund Details"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Method"}),e.jsx("p",{className:"text-lg",children:((A=s.method)==null?void 0:A.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Reason"}),e.jsx("p",{className:"text-sm",children:s.reason})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Source Transaction"}),e.jsxs("p",{className:"text-sm",children:[_.type," #",_.id]})]})]}),s.admin_notes&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Admin Notes"}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md",children:s.admin_notes})]}),s.rejection_reason&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm bg-red-50 text-red-800 p-3 rounded-md",children:s.rejection_reason})]})]})]}),e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Refund Items"}),e.jsx(V,{children:"Items included in this refund request"})]}),e.jsx(p,{children:e.jsxs(O,{children:[e.jsx(Q,{children:e.jsxs(S,{children:[e.jsx(l,{children:"Product"}),e.jsx(l,{children:"Variant"}),e.jsx(l,{children:"Qty"}),e.jsx(l,{children:"Unit Price"}),e.jsx(l,{children:"Total"}),e.jsx(l,{children:"QC Status"}),e.jsx(l,{children:"Actions"})]})}),e.jsx($,{children:s.refund_items.map(t=>e.jsxs(S,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.product.name}),t.product.sku&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["SKU: ",t.product.sku]})]})}),e.jsx(i,{children:t.product_variant&&e.jsxs("div",{className:"text-sm",children:[t.product_variant.color&&e.jsxs("div",{children:["Color: ",t.product_variant.color]}),t.product_variant.size&&e.jsxs("div",{children:["Size: ",t.product_variant.size]})]})}),e.jsx(i,{children:t.quantity}),e.jsxs(i,{children:["₹",t.unit_price.toLocaleString()]}),e.jsxs(i,{children:["₹",t.total_amount.toLocaleString()]}),e.jsx(i,{children:e.jsx(R,{className:ee[t.qc_status],children:t.qc_status.charAt(0).toUpperCase()+t.qc_status.slice(1)})}),e.jsx(i,{children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{const a=t.qc_status==="passed"?"failed":"passed";U(t.id,a,t.qc_notes||"")},children:t.qc_status==="passed"?"Mark Failed":"Mark Passed"})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{children:e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Customer Information"]})}),e.jsxs(p,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm",children:N.name})]}),e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:N.email})]}),N.phone&&e.jsxs("div",{children:[e.jsx(r,{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-sm",children:N.phone})]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Actions"})}),e.jsxs(p,{className:"space-y-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"outline",className:"w-full cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>v(!0),children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Approve Refund"]}),e.jsxs(c,{variant:"outline",className:"w-full cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>b(!0),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Reject Refund"]})]}),s.status==="approved"&&e.jsxs(c,{className:"w-full",onClick:L,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Process Refund"]}),s.credit_note&&e.jsxs(c,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"View Credit Note"]}),s.refund_transaction&&e.jsxs(c,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"View Transaction"]})]})]}),e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(h,{children:"Timeline"})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Requested"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),s.approved_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Approved"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j(new Date(s.approved_at),"MMM dd, yyyy HH:mm")})]})]}),s.processed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Processed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j(new Date(s.processed_at),"MMM dd, yyyy HH:mm")})]})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Completed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j(new Date(s.completed_at),"MMM dd, yyyy HH:mm")})]})]})]})]})]})]}),q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight text-gray-900 dark:text-gray-100",children:"Approve Refund"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Are you sure you want to approve this refund request?"})]}),e.jsxs("div",{className:"p-6 pt-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"admin_notes",className:"text-gray-900 dark:text-gray-100",children:"Admin Notes (Optional)"}),e.jsx(w,{id:"admin_notes",value:n,onChange:t=>g(t.target.value),placeholder:"Add any notes about this approval...",className:"mt-1 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:B,className:"flex-1",children:"Approve"}),e.jsx(c,{variant:"outline",onClick:()=>v(!1),className:"flex-1",children:"Cancel"})]})]})]})}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border shadow-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx("h3",{className:"text-2xl font-semibold leading-none tracking-tight text-gray-900 dark:text-gray-100",children:"Reject Refund"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Please provide a reason for rejecting this refund request."})]}),e.jsxs("div",{className:"p-6 pt-0 space-y-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"rejection_reason",className:"text-gray-900 dark:text-gray-100",children:"Rejection Reason *"}),e.jsx(w,{id:"rejection_reason",value:d,onChange:t=>k(t.target.value),placeholder:"Explain why this refund is being rejected...",required:!0,className:"mt-1 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"admin_notes_reject",className:"text-gray-900 dark:text-gray-100",children:"Admin Notes (Optional)"}),e.jsx(w,{id:"admin_notes_reject",value:n,onChange:t=>g(t.target.value),placeholder:"Add any additional notes...",className:"mt-1 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"destructive",onClick:D,className:"flex-1",disabled:!d.trim(),children:"Reject"}),e.jsx(c,{variant:"outline",onClick:()=>b(!1),className:"flex-1",children:"Cancel"})]})]})]})})]})]})}export{Ce as default};
