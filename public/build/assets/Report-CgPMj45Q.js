import{j as e,r as T,S as E}from"./app-CIhFobhL.js";import{D as $}from"./DashboardLayout-BRTFsDbd.js";import{C as n,a as t,b as d,c as i}from"./card-D1NucbTc.js";import{T as v,a as _,b as m,c,d as y,e as o}from"./table-C40jzP6z.js";import{B as S}from"./button-DzkUq3Lw.js";import{I as D}from"./input-CxgECS2K.js";import{L as F}from"./label-B-bzBIpf.js";import{F as U}from"./tooltip-CyAk2kzz.js";import{D as L}from"./download-BxFxXP3R.js";import{F as I}from"./filter-CV9oX-U0.js";import{C as H}from"./calendar-DzgPVLwh.js";import{C as O}from"./chart-pie-D5mVbgmt.js";import{C as M}from"./chart-column-5AQI2oI6.js";import"./utils-BqJV7cK7.js";import"./sweetalert2.esm.all-1yHLk2J-.js";import"./shopping-cart-D86C_673.js";import"./star-VEZdHhqn.js";import"./index-D00STa22.js";import"./index-DaPY9Q7-.js";import"./index-Chdu0Ess.js";import"./index-U3iOLidj.js";const B=({data:l,title:j,height:g=200})=>{const b=Math.max(...l.map(h=>h.value));return e.jsxs("div",{className:"w-full",children:[j&&e.jsx("h3",{className:"text-lg font-semibold mb-4",children:j}),e.jsx("div",{className:"space-y-3",children:l.map((h,f)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-20 text-sm font-medium text-right",children:h.label}),e.jsx("div",{className:"flex-1 relative",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-6",children:e.jsx("div",{className:`h-6 rounded-full transition-all duration-300 flex items-center justify-end pr-2 ${h.color||"bg-blue-600"}`,style:{width:`${h.value/b*100}%`},children:e.jsx("span",{className:"text-white text-xs font-medium",children:h.value})})})})]},f))})]})},q=({data:l,title:j,size:g=200})=>{const b=l.reduce((r,a)=>r+a.value,0);let h=0;const f=l.map(r=>{const a=r.value/b*100,x=r.value/b*360,u={...r,percentage:a.toFixed(1),startAngle:h,endAngle:h+x};return h+=x,u}),w=(r,a,x,u,s)=>{const p=N(r,a,x,s),R=N(r,a,x,u),P=s-u<=180?"0":"1";return["M",r,a,"L",p.x,p.y,"A",x,x,0,P,0,R.x,R.y,"Z"].join(" ")},N=(r,a,x,u)=>{const s=(u-90)*Math.PI/180;return{x:r+x*Math.cos(s),y:a+x*Math.sin(s)}},C=g/2,A=g/2,k=g/2-10;return e.jsxs("div",{className:"w-full",children:[j&&e.jsx("h3",{className:"text-lg font-semibold mb-4",children:j}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("svg",{width:g,height:g,className:"drop-shadow-sm",children:f.map((r,a)=>e.jsx("path",{d:w(C,A,k,r.startAngle,r.endAngle),fill:r.color,stroke:"white",strokeWidth:"2"},a))}),e.jsx("div",{className:"space-y-2",children:f.map((r,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-sm",style:{backgroundColor:r.color}}),e.jsxs("span",{className:"text-sm",children:[r.label,": ",r.value," (",r.percentage,"%)"]})]},a))})]})]})},xe=({stats:l})=>{var N,C,A,k,r,a,x,u;const[j,g]=T.useState(((N=l==null?void 0:l.filters)==null?void 0:N.date_from)||""),[b,h]=T.useState(((C=l==null?void 0:l.filters)==null?void 0:C.date_to)||""),f=()=>{E.get(route("refunds.report"),{date_from:j,date_to:b})},w=s=>{const p=new URLSearchParams({date_from:j,date_to:b,type:s});window.location.href=route("refunds.export")+"?"+p.toString()};return e.jsxs($,{title:"Refund Analytics Report",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-7 w-7 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Refunds Analytics & Reports"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{onClick:()=>w("summary"),variant:"outline",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Export Summary"]}),e.jsxs(S,{onClick:()=>w("detailed"),variant:"outline",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Export Detailed"]})]})]}),e.jsxs(n,{className:"mb-6",children:[e.jsx(t,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Date Range Filter"]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{htmlFor:"date_from",children:"From Date"}),e.jsx(D,{id:"date_from",type:"date",value:j,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(F,{htmlFor:"date_to",children:"To Date"}),e.jsx(D,{id:"date_to",type:"date",value:b,onChange:s=>h(s.target.value)})]}),e.jsxs(S,{onClick:f,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Apply Filter"]})]})})]}),l?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Total Refunds"})}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.total_refunds}),e.jsx("div",{className:"text-sm text-gray-500",children:"All time"})]})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Completed Amount"})}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl text-green-700 font-bold",children:["₹",Number(l.completed_amount||0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Successfully processed"})]})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Pending Amount"})}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl text-yellow-600 font-bold",children:["₹",Number(l.pending_amount||0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Awaiting approval"})]})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Average Refund"})}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-2xl text-blue-700 font-bold",children:["₹",Number(l.average_refund||0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Per transaction"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Average Approval Time"})}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(A=l.processing_time_stats)!=null&&A.avg_approval_time?`${Math.round(l.processing_time_stats.avg_approval_time)} hours`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:"From request to approval"})]})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Average Completion Time"})}),e.jsxs(i,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(k=l.processing_time_stats)!=null&&k.avg_completion_time?`${Math.round(l.processing_time_stats.avg_completion_time)} hours`:"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:"From approval to completion"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(t,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Refund Status Distribution"]})}),e.jsx(i,{children:e.jsx(q,{data:l.breakdown_by_status.map((s,p)=>({label:s.status.replace("_"," ").toUpperCase(),value:s.count,color:s.status==="completed"?"#10b981":s.status==="approved"?"#3b82f6":s.status==="pending"?"#f59e0b":s.status==="rejected"?"#ef4444":s.status==="processing"?"#8b5cf6":"#6b7280"}))})})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Refund Methods Distribution"]})}),e.jsx(i,{children:e.jsx(B,{data:l.breakdown_by_method.map(s=>({label:s.method.replace("_"," ").toUpperCase(),value:s.count,color:s.method==="credit_note"?"bg-blue-600":s.method==="money"?"bg-green-600":s.method==="razorpay"?"bg-purple-600":"bg-gray-600"}))})})]})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Refund Amount Distribution"]})}),e.jsx(i,{children:e.jsx(B,{data:((r=l.breakdown_by_amount_range)==null?void 0:r.map(s=>({label:s.range,value:s.count,color:"bg-indigo-600"})))||[],height:150})})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Breakdown by Refund Method"})}),e.jsx(i,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(c,{children:"Method"}),e.jsx(c,{children:"Count"}),e.jsx(c,{children:"Total Amount"})]})}),e.jsx(y,{children:l.breakdown_by_method.map(s=>e.jsxs(m,{children:[e.jsx(o,{children:s.method.replace("_"," ").toUpperCase()}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:["₹",s.total]})]},s.method))})]})})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Breakdown by Status"})}),e.jsx(i,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Count"}),e.jsx(c,{children:"Total Amount"})]})}),e.jsx(y,{children:l.breakdown_by_status.map(s=>e.jsxs(m,{children:[e.jsx(o,{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="approved"?"bg-blue-100 text-blue-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":s.status==="rejected"?"bg-red-100 text-red-800":s.status==="processing"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:s.status.replace("_"," ").toUpperCase()})}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:["₹",Number(s.total||0).toLocaleString()]})]},s.status))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Breakdown by Amount Range"})}),e.jsx(i,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(c,{children:"Amount Range"}),e.jsx(c,{children:"Count"})]})}),e.jsx(y,{children:(a=l.breakdown_by_amount_range)==null?void 0:a.map((s,p)=>e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:s.range}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.count}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${s.count/Math.max(...l.breakdown_by_amount_range.map(R=>R.count))*100}%`}})})]})})]},p))})]})})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Breakdown by Source"})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"POS Sales"}),e.jsx("span",{className:"text-lg font-bold text-blue-700",children:((x=l.breakdown_by_source)==null?void 0:x.pos_sales)||0})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-green-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"Online Orders"}),e.jsx("span",{className:"text-lg font-bold text-green-700",children:((u=l.breakdown_by_source)==null?void 0:u.online_orders)||0})]})]})})]})]}),l.breakdown_by_customer&&l.breakdown_by_customer.length>0&&e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Top Customers (Multiple Refunds)"})}),e.jsx(i,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Email"}),e.jsx(c,{children:"Refund Count"}),e.jsx(c,{children:"Total Amount"})]})}),e.jsx(y,{children:l.breakdown_by_customer.map((s,p)=>e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:s.customer_name}),e.jsx(o,{className:"text-gray-600",children:s.customer_email}),e.jsx(o,{children:e.jsxs("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium",children:[s.count," refunds"]})}),e.jsxs(o,{className:"font-bold",children:["₹",Number(s.total).toLocaleString()]})]},p))})]})})]}),e.jsxs(n,{children:[e.jsx(t,{children:e.jsx(d,{children:"Refunds per Day (last 30 days)"})}),e.jsx(i,{children:e.jsxs(v,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Total Count"}),e.jsx(c,{children:"Total Amount"})]})}),e.jsx(y,{children:l.breakdown_by_day.map(s=>e.jsxs(m,{children:[e.jsx(o,{children:s.day}),e.jsx(o,{children:s.count}),e.jsxs(o,{children:["₹",Number(s.total).toLocaleString()]})]},s.day))})]})})]})]}):e.jsx("div",{children:"Loading analytics ..."})]})};export{xe as default};
