import{j as e,r as w,m as S,U as v,$ as C,S as I}from"./app-B1tbhmxy.js";import{D as T}from"./DashboardLayout-BbqqHCPX.js";import{B as j}from"./button-DDA_8geh.js";import{C as k,c as _}from"./card--ysWr4UQ.js";import{C as E,a as $,b as V,c as O,d as B,E as F}from"./EmptyState-B7JeyPNl.js";import{D as H,C as R,P as z}from"./dnd.esm-BfyoEYZw.js";import{B as G}from"./badge-BurJTqaP.js";import{T as L,a as U,b as D,c as m,d as q,e as x}from"./table-BKgf5XeM.js";import{A as J,a as M,b as K,c as Q,d as W,e as X,f as Y,g as Z,h as ee}from"./alert-dialog-CL9UaDuu.js";import{G as re}from"./grip-vertical-BeenFyXa.js";import{S as se}from"./star-kJwlYSpi.js";import{T as ae}from"./trash-2-Dmd3WFPO.js";import{t as n}from"./tooltip-r3E1xT1A.js";import{A as te}from"./arrow-left-D9jEqqa1.js";import{P as oe}from"./plus-JdJYePoK.js";import"./utils-ugRebPKk.js";import"./sweetalert2.esm.all-1yHLk2J-.js";import"./shopping-cart-Cgi-a0_P.js";import"./index-Pekh2N-E.js";import"./index-OPuGH7Zc.js";import"./index-CI-oCjGr.js";import"./arrow-right-CtTW30Fg.js";import"./circle-plus-Ck2zjfqq.js";import"./tiny-invariant-BaFNuDhB.js";import"./index-BIVnE3JH.js";import"./Combination-bL0gimUD.js";import"./index-RLN4sl0J.js";function ie({images:r,variantName:i}){return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Variant Image Gallery Preview"}),e.jsxs(E,{className:"w-full max-w-4xl mx-auto",children:[e.jsx($,{children:r.map(t=>e.jsx(V,{className:"basis-full md:basis-1/2 lg:basis-1/3",children:e.jsx("div",{className:"p-1",children:e.jsx(k,{children:e.jsxs(_,{className:"flex aspect-square items-center justify-center p-2 relative",children:[e.jsx("img",{src:`/storage/${t.image_path}`,alt:t.alt_text||i,className:"w-full h-full object-cover rounded"}),t.is_primary&&e.jsx("div",{className:"absolute top-3 right-3 bg-yellow-400 text-black text-xs font-bold px-2 py-1 rounded-full",children:"Primary"})]})})})},t.id))}),e.jsx(O,{className:"left-1"}),e.jsx(B,{className:"right-1"})]})]})}function le({images:r,onDelete:i,onSetPrimary:t,onDragEnd:l}){const[c,p]=w.useState(null);return e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Manage Images"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Drag and drop to reorder images"})]}),e.jsx(H,{onDragEnd:l,children:e.jsx(R,{droppableId:"images-table",children:h=>e.jsxs(L,{children:[e.jsx(U,{children:e.jsxs(D,{children:[e.jsx(m,{className:"w-12"}),e.jsx(m,{children:"Image"}),e.jsx(m,{children:"Alt Text"}),e.jsx(m,{children:"Primary"}),e.jsx(m,{children:"Order"}),e.jsx(m,{children:"Actions"})]})}),e.jsxs(q,{...h.droppableProps,ref:h.innerRef,children:[r.map((a,f)=>e.jsx(z,{draggableId:a.id.toString(),index:f,children:u=>e.jsxs(D,{ref:u.innerRef,...u.draggableProps,children:[e.jsx(x,{children:e.jsx("div",{...u.dragHandleProps,className:"cursor-grab",children:e.jsx(re,{className:"h-4 w-4 text-gray-400"})})}),e.jsx(x,{children:e.jsx("img",{src:`/storage/${a.image_path}`,alt:a.alt_text||"Variant image",className:"w-16 h-16 object-cover rounded"})}),e.jsx(x,{children:e.jsx("span",{className:"text-sm",children:a.alt_text||"-"})}),e.jsx(x,{children:a.is_primary?e.jsxs(G,{variant:"default",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Primary"]}):e.jsx(j,{variant:"outline",className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",size:"sm",onClick:()=>t(a.id),children:"Set Primary"})}),e.jsx(x,{children:e.jsx("span",{className:"text-sm text-gray-500",children:a.display_order})}),e.jsx(x,{children:e.jsxs(J,{children:[e.jsx(M,{asChild:!0,children:e.jsx(j,{variant:"destructive",size:"sm",onClick:()=>p(a.id),className:"cursor-pointer hover:bg-red-100 dark:hover:bg-red-800",children:e.jsx(ae,{className:"w-4 h-4"})})}),e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Delete Image"}),e.jsx(X,{children:"Are you sure you want to delete this image? This action cannot be undone."})]}),e.jsxs(Y,{children:[e.jsx(Z,{onClick:()=>p(null),className:"cursor-pointer",children:"Cancel"}),e.jsx(ee,{onClick:()=>{c&&(i(c),p(null))},className:"bg-red-600 hover:bg-red-700 cursor-pointer",children:"Delete"})]})]})]})})]})},a.id.toString())),h.placeholder]})]})})})]})}function Ve({variant:r,images:i,success:t}){var y,N;const[l,c]=w.useState(i||[]),{delete:p}=S();v.useEffect(()=>{t&&n.success(t)},[t]),v.useEffect(()=>{c(i||[])},[i]);const h=s=>{p(route("product-variant-images.destroy",s),{onSuccess:()=>n.success("Image deleted successfully"),onError:()=>n.error("Failed to delete image")})},a=s=>{I.post(route("product-variant-images.set-primary",{image:s}),{},{onSuccess:()=>{c(o=>o.map(d=>({...d,is_primary:d.id===s}))),n.success("Primary image updated")},onError:()=>n.error("Failed to update primary image")})},f=s=>{if(!s.destination)return;const o=Array.from(l),[d]=o.splice(s.source.index,1);o.splice(s.destination.index,0,d);const g=o.map((A,P)=>({...A,display_order:P+1}));c(g)},u=()=>{const s={images:l.map((o,d)=>({id:o.id,display_order:d+1}))};console.log("saveOrder payload snapshot:",JSON.stringify(s)),I.post(route("product-variant-images.update-order",{variant:r.id}),s,{onSuccess:()=>n.success("Image order updated successfully"),onError:()=>n.error("Failed to update image order")})},b=`${r.product.name} - ${((y=r.color)==null?void 0:y.name)||""} ${((N=r.size)==null?void 0:N.name)||""} (${r.sku})`.trim();return e.jsx(T,{title:`Variant Images - ${b}`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(C,{href:route("product-variants.index",r.product_id),className:"flex w-54 items-center text-sm text-gray-600 hover:text-gray-900 border border-gray-300 rounded-md p-2 mb-2",children:[e.jsx(te,{className:"w-4 h-4 mr-1 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"}),"Back to Product Variants"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Variant Images - ",b]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[(()=>{const s=i.map(g=>g.id).join(","),o=l.map(g=>g.id).join(",");return s!==o})()&&e.jsx(j,{onClick:u,variant:"outline",className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",children:"Save Order"}),e.jsx(C,{href:route("product-variant-images.create",r.id),children:e.jsxs(j,{variant:"outline",className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Add Images"]})})]})]}),l.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ie,{images:l,variantName:b}),e.jsx(le,{images:l,onDelete:h,onSetPrimary:a,onDragEnd:f})]}):e.jsx(F,{title:"No images uploaded yet",description:"Upload images to showcase this product variant.",actionText:"Add Images",actionHref:route("product-variant-images.create",r.id),productId:r.product_id})]})})}export{Ve as default};
