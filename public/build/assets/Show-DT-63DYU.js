import{r as N,j as e,L as E,S as j}from"./app-DF2liKJQ.js";import{D as V}from"./DashboardLayout-_MNNtgTW.js";import{B as n}from"./button-CSMxSizN.js";import{B as S}from"./badge-DFa9dVy_.js";import{C as l,a as i,b as o,c as d,d as b}from"./card-CRdfoNyN.js";import{T as O,a as Q,b as M,c as m,d as $,e as x}from"./table-CXUrIRGU.js";import{T as _}from"./textarea-3DvqjzVC.js";import{L as a}from"./label-Dxaq2a1S.js";import{A as K}from"./arrow-left-DuhAv287.js";import{U as X,F as G}from"./user-DCLcrHz4.js";import{C as u}from"./circle-check-big-CJ4Brujv.js";import{C as v}from"./circle-x-DfpsF4Fd.js";import{P as q}from"./package-DAFlmMNH.js";import{C as J}from"./credit-card-Bq_JjSxW.js";import{C as w}from"./clock-CEelsxKF.js";import{C as W}from"./circle-alert-BRQRDaZ_.js";import{f as p}from"./format-CBpsKyOP.js";import"./index-DezPPtMi.js";import"./utils-YRq8zgdo.js";import"./index-M4HIUlSQ.js";import"./sweetalert2.esm.all-DGhwgajj.js";import"./shopping-cart-CDHmQEtA.js";import"./log-out-zVsE4qPx.js";const Y={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800",processing:"bg-purple-100 text-purple-800",completed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800"},Z={pending:w,approved:u,rejected:v,processing:W,completed:u,failed:v,cancelled:v},ee={pending:"bg-yellow-100 text-yellow-800",passed:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800"};function _e({refund:s}){var k;const[T,y]=N.useState(!1),[F,C]=N.useState(!1),[c,g]=N.useState(s.admin_notes||""),[h,A]=N.useState(""),H=t=>{const r=Z[t]||w;return e.jsx(r,{className:"h-4 w-4"})},P=()=>{var t,r;return s.customer?s.customer:(t=s.sale)!=null&&t.customer?s.sale.customer:(r=s.order)!=null&&r.customer?s.order.customer:{name:"N/A",email:"N/A",phone:"N/A"}},B=()=>s.sale?{type:"Sale",id:s.sale.id}:s.order?{type:"Order",id:s.order.id}:{type:"N/A",id:"N/A"},D=()=>{if(console.log("Approve button clicked",{refund_id:s.id,admin_notes:c}),c.length>1e3){alert("Admin notes cannot exceed 1000 characters");return}j.post(route("refunds.approve",s.id),{admin_notes:c},{onSuccess:t=>{console.log("Approval successful",t),y(!1),g("")},onError:t=>{console.error("Approval failed",t);const r=t.error||"Failed to approve refund. Please try again.";alert(r)},onFinish:()=>{console.log("Approval request finished")}})},L=()=>{if(!h.trim()){alert("Rejection reason is required");return}if(h.trim().length<10){alert("Rejection reason must be at least 10 characters long");return}if(h.length>1e3){alert("Rejection reason cannot exceed 1000 characters");return}if(c.length>1e3){alert("Admin notes cannot exceed 1000 characters");return}j.post(route("refunds.reject",s.id),{rejection_reason:h.trim(),admin_notes:c},{onSuccess:()=>{C(!1),A(""),g("")},onError:t=>{console.error("Rejection failed",t);const r=t.error||"Failed to reject refund. Please try again.";alert(r)}})},U=()=>{j.post(route("refunds.process",s.id))},z=(t,r,I)=>{j.put(route("refund-items.update-qc-status",t),{qc_status:r,qc_notes:I})},f=P(),R=B();return e.jsxs(V,{title:`Refund ${s.reference}`,children:[e.jsx(E,{title:`Refund ${s.reference}`}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"outline",className:"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",size:"sm",onClick:()=>j.get(route("refunds.index")),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Back to Refunds"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight",children:["Refund ",s.reference]}),e.jsxs("p",{className:"text-muted-foreground",children:["Created on ",p(new Date(s.created_at),"MMM dd, yyyy HH:mm")]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(S,{className:Y[s.status],children:e.jsxs("span",{className:"flex items-center gap-1",children:[H(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(o,{children:"Refund Details"})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"text-2xl font-bold",children:["₹",s.amount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Method"}),e.jsx("p",{className:"text-lg",children:((k=s.method)==null?void 0:k.replace("_"," ").toUpperCase())||"N/A"})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Reason"}),e.jsx("p",{className:"text-sm",children:s.reason})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Source Transaction"}),e.jsxs("p",{className:"text-sm",children:[R.type," #",R.id]})]})]}),s.admin_notes&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Admin Notes"}),e.jsx("p",{className:"text-sm bg-muted p-3 rounded-md",children:s.admin_notes})]}),s.rejection_reason&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm bg-red-50 text-red-800 p-3 rounded-md",children:s.rejection_reason})]})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(o,{children:"Refund Items"}),e.jsx(b,{children:"Items included in this refund request"})]}),e.jsx(d,{children:e.jsxs(O,{children:[e.jsx(Q,{children:e.jsxs(M,{children:[e.jsx(m,{children:"Product"}),e.jsx(m,{children:"Variant"}),e.jsx(m,{children:"Qty"}),e.jsx(m,{children:"Unit Price"}),e.jsx(m,{children:"Total"}),e.jsx(m,{children:"QC Status"}),e.jsx(m,{children:"Actions"})]})}),e.jsx($,{children:s.refund_items.map(t=>e.jsxs(M,{children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.product.name}),t.product.sku&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["SKU: ",t.product.sku]})]})}),e.jsx(x,{children:t.product_variant&&e.jsxs("div",{className:"text-sm",children:[t.product_variant.color&&e.jsxs("div",{children:["Color: ",t.product_variant.color]}),t.product_variant.size&&e.jsxs("div",{children:["Size: ",t.product_variant.size]})]})}),e.jsx(x,{children:t.quantity}),e.jsxs(x,{children:["₹",t.unit_price.toLocaleString()]}),e.jsxs(x,{children:["₹",t.total_amount.toLocaleString()]}),e.jsx(x,{children:e.jsx(S,{className:ee[t.qc_status],children:t.qc_status.charAt(0).toUpperCase()+t.qc_status.slice(1)})}),e.jsx(x,{children:e.jsx(n,{variant:"outline",size:"sm",onClick:()=>{const r=t.qc_status==="passed"?"failed":"passed";z(t.id,r,t.qc_notes||"")},children:t.qc_status==="passed"?"Mark Failed":"Mark Passed"})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Customer Information"]})}),e.jsxs(d,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm",children:f.name})]}),e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:f.email})]}),f.phone&&e.jsxs("div",{children:[e.jsx(a,{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-sm",children:f.phone})]})]})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(o,{children:"Actions"})}),e.jsxs(d,{className:"space-y-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"outline",className:"w-full cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>y(!0),children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Approve Refund"]}),e.jsxs(n,{variant:"outline",className:"w-full cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>C(!0),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Reject Refund"]})]}),s.status==="approved"&&e.jsxs(n,{className:"w-full",onClick:U,children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Process Refund"]}),s.credit_note&&e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"View Credit Note"]}),s.refund_transaction&&e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>{},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"View Transaction"]})]})]}),e.jsxs(l,{children:[e.jsx(i,{children:e.jsx(o,{children:"Timeline"})}),e.jsxs(d,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Requested"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p(new Date(s.created_at),"MMM dd, yyyy HH:mm")})]})]}),s.approved_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Approved"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p(new Date(s.approved_at),"MMM dd, yyyy HH:mm")})]})]}),s.processed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-4 w-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Processed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p(new Date(s.processed_at),"MMM dd, yyyy HH:mm")})]})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-4 w-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Completed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p(new Date(s.completed_at),"MMM dd, yyyy HH:mm")})]})]})]})]})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(o,{children:"Approve Refund"}),e.jsx(b,{children:"Are you sure you want to approve this refund request?"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"admin_notes",children:"Admin Notes (Optional)"}),e.jsx(_,{id:"admin_notes",value:c,onChange:t=>g(t.target.value),placeholder:"Add any notes about this approval..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{onClick:D,className:"flex-1",children:"Approve"}),e.jsx(n,{variant:"outline",onClick:()=>y(!1),className:"flex-1",children:"Cancel"})]})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(l,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(o,{children:"Reject Refund"}),e.jsx(b,{children:"Please provide a reason for rejecting this refund request."})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"rejection_reason",children:"Rejection Reason *"}),e.jsx(_,{id:"rejection_reason",value:h,onChange:t=>A(t.target.value),placeholder:"Explain why this refund is being rejected...",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"admin_notes_reject",children:"Admin Notes (Optional)"}),e.jsx(_,{id:"admin_notes_reject",value:c,onChange:t=>g(t.target.value),placeholder:"Add any additional notes..."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"destructive",onClick:L,className:"flex-1",disabled:!h.trim(),children:"Reject"}),e.jsx(n,{variant:"outline",onClick:()=>C(!1),className:"flex-1",children:"Cancel"})]})]})]})})]})]})}export{_e as default};
